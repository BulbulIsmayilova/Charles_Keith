(function(A,ba,L,n){if(n){var l={},B=L.CookieManager,q=L.tagHelpers,S=q.get("dv").device,v={},g={items:{}},M=null,N=!1,V=L.outputs.basketBackup.endpoint,O=L.outputs.basketBackup.campaign_id,x="undefined"===typeof A.$smcBBDB?0:1,w=q.DBC.custom("Basket Backup","red"),C=q.DBW.custom("Basket Backup","red"),W=q.DBE.custom("Basket Backup","red");x&&$smcBBDB.init($smcJQ);var P=function(){return x&&$smcBBDB.showTimers?!0:!1},K=!1,R=function(b){var d=b?"keep-alive-2":"store",a=0,e=q.get("dv");e&&e.id&&(a=
    e.id);a={bb_tid:q.get("id"),bb_uid_v:"v4",bb_uid:Q(),bb_cid:O,bb_did:a};b||(a.bb_data=JSON.stringify(l));K||(K=!0,n.post(V+"?handle="+d,a,function(c){1==c.r&&w(b?"BB - Keep Alive":"BB - User Data Posted",c);K=!1}))},ca=function(){if(!l.email)return!1;R(!0);var b=0,d=[10,20,30,60,120,300,600,900],a=0;n("html").on("touchstart touchmove mouseover mousemove mousedown click keypress",function(){a=0});setInterval(function(){if(K)return w("BB - XHR  already in progress...",K),!1;if("hidden"==ba.visibilityState)return w("Tab/Window is not focused... will not run Keep alive!"),
    !1;b++;0===b%d[a]&&(a<d.length-1&&a++,R(!0))},1E3)},T=!1,da=function(b){var d=b;setInterval(function(){!1===T&&JSON.stringify(l)!==d&&(T=q.DateNow(),d=JSON.stringify(l),x&&(w("BB - data set from state change"),$smcBBDB.userData=l,$smcBBDB.scanner($smcJQ)),R(),setTimeout(function(){T=!1},1E3))},100)},E=function(b){if(-1===b.indexOf("#")||-1===b.indexOf(":"))return b;b=b.split(" ");var d=[],a;for(a in b)if(b.hasOwnProperty(a)){var e=b[a];"#"===e.substr(0,1)&&-1<e.indexOf(":")&&-1===e.indexOf("\\:")&&
(e=e.replace(/:/g,"\\:"));d.push(e)}return d=d.join(" ")};x&&($smcBBDB.deleteData=function(){l={delete_data:1};B.del("smc_bb_confirmed");R();setTimeout(function(){A.location.reload()},300)});var X=function(b,d){if(!b||!d||0===d.length)return!1;var a=d[0];b=b.toString().trim().toLowerCase();switch(b){case "image":if("IMG"!==a.nodeName&&(a=d.find("img:first")[0],0==a.length))return!1;a=a.getAttribute("src")||a.getAttribute("srcset")||null;if(!a)return!1;if(-1!==a.indexOf("data:image"))return a;-1!==
    a.indexOf(",")&&(a=a.split(",")[0]);"//"===a.substr(0,2)?a="https:"+a:"/"!=a.charAt(0)&&-1===a.indexOf("http")&&(a="/"+a);a=a.replace(/ /g,"%20");return-1==a.indexOf("http")?A.location.origin+a:a;case "qty":case "quantity":if("SELECT"===a.nodeName)var e=a[a.selectedIndex].value;else e=a.value||a.getAttribute("value")||!1,!1===e&&(e=d.find("input:first").val()||!1),!1===e&&(e=a.textContent||!1);var c=RegExp("[0-9]+","ig");return(c=c.exec(e))?c[0]:!1;case "value":return c=RegExp("[0-9,.]+","ig"),a=
        a.textContent||a.value||a.getAttribute("value"),null===a?!1:(c=a.match(c))&&0!==c.length||!a?c&&0!==c.length||a?1===c.length?c[0]:c[c.length-1]:!1:a.trim().replace(/\s+/g," ");case "price":return c=a.textContent||a.value||a.getAttribute("value"),q.priceFinder.searcher(c);case "link":return"A"===a.nodeName?a=d:(a=d.find("a:first"),0==a.length&&(a=d.closest("a"))),(a=a.attr("href"))&&"/"!=a.charAt(0)&&-1===a.indexOf("http")&&(a="/"+a),(a=a.replace(/ /g,"%20"))&&-1==a.indexOf("http")?A.location.origin+
        a:a;case "currency":return c=a.textContent||a.innerHTML||!1,q.priceFinder.currencySearch(c);case "html":return 0<d.find("script").length&&d.find("script").remove(),d.html().trim()||!1;default:return(c=a.value||a.getAttribute("value")||a.textContent||!1)&&"password"===a.type&&(c="***********",C("Security Override - Will not read password values back")),c&&"string"===typeof c?c.trim().replace(/\s+/g," "):!1}},U=function(b,d){var a=!1;if(!b.func)return w("WARNING: processSelectors() func missing",b),
        !1;if("custom"===b.func.toLowerCase())try{var e=JSON.parse(b.custom);if(e&&("text"===e.type.toLowerCase()?a=X(e.type,d):"attr"===e.type.toLowerCase()&&e.value&&(a=d.attr(e.value)||!1),a&&e.functions)){var c=a,f=e.functions,r;for(r in f)if(f.hasOwnProperty(r))for(var p in f[r])if(f[r].hasOwnProperty(p)){p=p.toLowerCase();var h=f[r][p];switch(p){case "replace":if("object"===typeof f[r][p]){var m=h[0],y=h[1];if(m&&y){var t=new RegExp(m,"g");c=c.replace(t,y)}}break;case "before":var k="string"===typeof h?
        h:h[0];k&&-1<c.indexOf(k)&&(c=c.split(k)[0].trim());case "after":var u="string"===typeof h?h:h[0];u&&-1<c.indexOf(u)&&(c=c.split(u)[1].trim());break;case "split":if("object"===typeof h){var F=h[0],z=h[1];if(F&&z){var G=c.split(F);G[z]&&(c=G[z])}}break;case "prepend":var H="string"===typeof h?h:h[0];H&&(c=H+c);break;case "append":var I="string"===typeof h?h:h[0];I&&(c+=I);break;case "regex":var J="string"===typeof h?h:h[0];J&&(t=new RegExp(J,"g"),c=c.replace(t,""))}}a=c}}catch(D){console.warn("CUSTOM Error: ",
        D)}else a=X(b.func,d);return a},ea=function(){var b=q.queryString("smc_bbeid",!1);if(null!==b){b=b.split("-");var d=b[0];b=b[1];var a=q.DateNow();isNaN(parseInt(d,10))||isNaN(parseInt(b,10))||(B.create("smc_bb_emailclick",JSON.stringify([parseInt(d,10),parseInt(b,10),a]),0),x&&w("Email Clicked: ",JSON.parse(B.read("smc_bb_emailclick"))))}b=q.queryString("smcbb_voucher",!1);null!==b&&B.create("smc_vc",JSON.stringify({v:b,d:q.DateNow(),u:null,e:7}),10080)},fa=function(){var b=v.basket_select;if(!b)return C("No Basket Selectors set..."),
        !1;var d="tablet"===S&&1==b.tablet.active?"tablet":"tablet"!==S&&"mobile"!==S||1!=b.mobile.active?"desktop":"mobile";var a=function(m){return isNaN(m)?0:Math.round(parseFloat((m*Math.pow(10,2)).toFixed(2)))/Math.pow(10,2)},e=b[d],c=e.items,f=e.strict_mode;if(!c)return C("Basket Backup - No Selector Items!"),!1;b=v.basket_page_match;var r=[];b&&""!==b.trim()&&(r=b.split(","));var p=!1,h=function(){P()&&console.time("Basket Scanner");var m=!1,y=!1;0<n(E(e.cssPathWrapper)).length&&(m=n(E(e.cssPathWrapper)));
        m&&0<m.find(e.cssPathEach).length&&(y=m.find(E(e.cssPathEach)).length);for(var t in r)if(r.hasOwnProperty(t)){var k=r[t].trim();"SELECTOR:"===k.substr(0,9)||"ELEMENT:"===k.substr(0,8)?(k=k.replace("SELECTOR:","").replace("ELEMENT:",""),3<k.length&&0<n(k).length&&(p=!0)):-1<A.location.href.toLowerCase().indexOf(k.toLowerCase())&&(p=!0)}g.value=0;g.count=0;g.setupType=d;g.currency="";m&&y?(g.items={},m.find(E(e.cssPathEach)).each(function(G,H){n.each(c,function(I,J){var D=U(J,n(H).find(E(J.cssPath)));
            !1!==D&&(g.items["row_"+G]||(g.items["row_"+G]={}),g.items["row_"+G]["item_"+I]={variable:J.variable,value:!1===D?"":D})})})):""===e.cssPathWrapper.trim()&&(g.items={},n.each(c,function(G,H){n(E(H.cssPath)).each(function(I,J){var D=U(H,n(J));!1!==D&&(g.items["row_"+I]||(g.items["row_"+I]={}),g.items["row_"+I][G]={variable:H.variable,value:!1===D?"":D})})}));if(m&&0===r.length||m&&0<r.length&&!0===p||""===e.cssPathWrapper.trim()&&p||""!==e.cssPathWrapper.trim()&&p){if(f){m=0;for(t in c)c.hasOwnProperty(t)&&
        m++;for(var u in g.items)if(g.items.hasOwnProperty(u)){t=0;for(var F in g.items[u])g.items[u].hasOwnProperty(F)&&t++;t!==m&&(C("Strict Mode - Row was Deleted as "+(m-t)+" items missing"),delete g.items[u])}}m=0;for(u in g.items)if(g.items.hasOwnProperty(u)){m++;y=t=0;for(F in g.items[u])if(g.items[u].hasOwnProperty(F)){k=g.items[u][F].variable;var z=g.items[u][F].value;"{{item_count}}"===k&&z&&!isNaN(parseInt(z,10))&&(t=parseInt(z,10),g.count+=t);"{{item_value}}"!==k&&"{{item_price}}"!==k||!z||(y=
            q.priceFinder.convertForMaths(z));"{{item_currency}}"!==k&&"{{item_price}}"!==k||!z||(g.currency=q.priceFinder.currencySearch(z))}0===t&&(t=1);g.value+=y*t}0<m&&0===g.count&&(g.count=m);g.value=a(g.value);l.basket=g}P()&&console.timeEnd("Basket Scanner")};h();setInterval(function(){h()},1E3)},ha=function(){var b=v.misc_selectors;if(b){var d=function(){P()&&console.time("Misc Scanner");n.each(b,function(a,e){var c=!1;if(e.custom){var f=JSON.parse(e.custom);if(f&&"dynamic"===f.type.toLowerCase()&&f.value){c=
        $smcT5.outputs.dynamic[f.value];if(("true"===f.atob||!0===f.atob)&&void 0!==c)try{c=atob(c)}catch(r){w(f.value+": "+r),c=!1}"true"!==f.decodeURIComponent&&!0!==f.decodeURIComponent||void 0===c||(c=decodeURIComponent(c));if(void 0===c||null===c)c=!1}}!1===c&&0<n(E(e.cssPath)).length&&(c=U(e,n(E(e.cssPath))));!1!==c&&""!==c&&("undefined"===typeof l.misc&&(l.misc={}),l.misc["item_"+a]={variable:e.variable,value:!1===c?"":c})});P()&&console.timeEnd("Misc Scanner")};d();setInterval(function(){d()},1E3)}},
    ia=function(){var b=v.email_input,d=!1;if(!b||""===b.trim())return C("BB - No Email Selector..."),!1;var a=function(e){e=e.trim().toLowerCase();w("Checking...",e);q.validateEmail(e)&&e!==N&&(clearInterval(d),N=e,l.email=N,w("Valid Email: ",N))};"objectscanner|"===b.toLowerCase().substr(0,14)||"windowvariable|"===b.toLowerCase().substr(0,15)?d=setInterval(function(){try{var e=b.split("|"),c=e[0],f=e[1],r=e[2];if("objectscanner"===c.toLowerCase()&&void 0!==f&&void 0!==r){if(A[f]){var p=$smcT5.tagHelpers.objectScanner.scanResult([A[f]],
        r);p&&"string"===typeof p&&a(p)}}else"windowvariable"===c.toLowerCase()&&void 0!==f&&(p=A[f],"string"===typeof p&&a(p))}catch(h){W(h)}},1E3):(n("body").on("keyup touchend",b,function(e){e=n(this).val();w("1111.",e,typeof e);a(e)}),d=setInterval(function(){n(b).each(function(e,c){if(n(this).val()&&""!==n(this).val().trim()){var f=n(this).val();a(f)}})},1E3))},ja=function(){var b=v.confirm_match;if(!b||""===b.trim())return!1;b=b.split(",");var d=null,a=function(c){clearInterval(d);var f={ttl:v.campaign_ttl,
        ttl_secs:v.campaign_ttl_secs,ts:q.DateNow(),method:c},r=v.campaign_ttl_secs/60;B.create("smc_bb_confirmed",JSON.stringify(f),r);l.confirmed_method=c;l.confirmed_ttl=v.campaign_ttl;l.confirmed_ttl_secs=v.campaign_ttl_secs;l.confirmed_ts=q.DateNow();l.confirmed=1;a:{if(null!==B.read("smc_bb_emailclick"))try{var p=JSON.parse(B.read("smc_bb_emailclick")),h=p[0],m=p[1],y=p[2],t=(q.DateNow()-y)/1E3;var k={tid:h,lc:m,ts:y,secs:t};break a}catch(u){W(["Email Click Cookie is broken!",u])}k=!1}k&&(l.confirmed_e_tid=
        k.tid,l.confirmed_e_lc=k.lc,l.confirmed_e_secs=k.secs,l.confirmed_e_ts=k.ts,w("Confirmed with Email Click!!",k))},e=function(){for(var c in b)if(b.hasOwnProperty(c)){var f=b[c].trim();"SELECTOR:"===f.substr(0,9)||"ELEMENT:"===f.substr(0,8)?(f=f.replace("SELECTOR:","").replace("ELEMENT:",""),3<f.length&&0<n(f).length&&a(b[c].trim()+" ("+n(f).length+")")):-1<A.location.href.toLowerCase().indexOf(f.toLowerCase())&&a('URL Match: "'+f+'"')}!0===$smcT5.outputs.goalMatch&&a("Tag Goal Match")};e();d=setInterval(function(){e()},
        1E3)},ka=function(){if(x){var b=JSON.stringify($smcBBDB.campaignSetup),d=$smcBBDB.userData?JSON.stringify($smcBBDB.userData):"";$smcBBDB.campaignSetup=v;$smcBBDB.campaign_id=O;console.table({"Basket Backup Campaign":{Object:"$smcBBDB.campaignSetup",Info:10<b.length?"Size: "+b.length.toString():b},"Basket Backup User Data":{Object:"$smcBBDB.userData",Info:10<d.length?"Size: "+d.length.toString():d},"Displaying Times":{Object:"$smcBBDB.showTimers",Info:"Set it to = 1 to show times"},"Deleting Data":{Object:"$smcBBDB.deleteData()",
            Info:"Deletes data from FE and Server"},"Campaign ID":{Object:"$smcBBDB.campaign_id",Info:"Returns the campaign ID ("+O+")"}});0==M&&C("BASKET BACKUP IS OFF BUT IS ON FOR DEBUGGING");setTimeout(function(){$smcBBDB.scanner($smcJQ)},500)}da(JSON.stringify(l));ia();fa();ha();ja();ea();ca()},Y=function(b){return"string"===typeof b?JSON.parse(b):b},Z=function(b,d){((void 0===d?0:d)||!Q())&&localStorage.setItem("smc-bbuid",b)},Q=function(){var b=localStorage.getItem("smc-bbuid");return"string"===typeof b?
        b:!1},aa=function(b){b.bb_uid=Q();n.post(V+"?handle=campaign",b,function(d){1==d.r?(M=d.setup.active,x&&0==M||1==M?(v=Y(d.setup.campaign_data),v.uuid&&Z(v.uuid),x&&($smcBBDB.campaignSetup=v,$smcBBDB.campaign_revision_behind=d.setup.campaign_revision_behind),d.setup.user_data&&"[]"!==JSON.stringify(d.setup.user_data)&&(l=Y(d.setup.user_data),x&&(w("User Data Set from Server: ",l),$smcBBDB.userData=l)),ka()):w("Basket Backup is Off")):0==d.r&&d.errors&&d.errors.uuid?(Z(d.errors.uuid,!0),setTimeout(function(){C("BASKET BACKUP - Reposting campaign now User ID is set");
        aa(b)},1E3)):C("BB - Not Loaded: ",d.msg||d.errors)})};(function(){if(null!==B.read("smc_bb_confirmed")){if(x){var b=JSON.parse(B.read("smc_bb_confirmed"));$smcBBDB.userData={confirmed:1,confirmed_method:b.method,confirmed_ttl:b.ttl,confirmed_ttl_secs:b.ttl_secs,confirmed_ts:b.ts};setTimeout(function(){$smcBBDB.scanner($smcJQ)},500);C("BASKET BACKUP - Confirmed Match. Will not Execute further",b)}return!1}b={bb_tid:q.get("id"),bb_uid:Q(),bb_uid_v:"v4",bb_cid:O};x&&(b.bb_debug=1);aa(b)})()}else console.warn("BB - No jQ")})(window,
    document,$smcT5,$smcJQ);